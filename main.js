!function(){"use strict";var e=class{constructor(e,t){this._settings=e,this._inputSelector=e.inputSelector,this._inputErrorClass=e.inputErrorClass,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._form=t,this._inputEls=[...this._form.querySelectorAll(this._inputSelector)],this._button=this._form.querySelector(this._submitButtonSelector)}_showInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.classList.add(this._settings.errorClass),t.textContent=e.validationMessage}_hideInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.classList.remove(this._settings.errorClass),t.textContent=""}_toggleButtonState(){this._hasInvalidInput()?this.disableButton():(this._button.classList.remove(this._inactiveButtonClass),this._button.disabled=!1)}disableButton(){this._button.classList.add(this._inactiveButtonClass),this._button.disabled=!0}_hasInvalidInput(){return this._inputEls.some((e=>!e.validity.valid||""===e.value.trim()))}_checkInvalidValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_setEventListeners(){this._inputEls.forEach((e=>{e.addEventListener("input",(()=>{this._checkInvalidValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners(),this._toggleButtonState()}resetValidation(){this._inputEls.forEach((e=>{this._hideInputError(e)})),this.disableButton()}};const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit",inactiveButtonClass:"modal__submit_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};class s{constructor(e,t,s,n){this._name=e.name,this._link=e.link,this._id=e._id,this._isLiked=e.isLiked,this._cardSelector=t,this._handleImageClick=s,this._api=n,this._handleLikeIcon=this._handleLikeIcon.bind(this)}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._cardLikeButton.addEventListener("click",this._handleLikeIcon),this._element.querySelector(".card__image").addEventListener("click",(()=>{this._handleImageClick({name:this._name,link:this._link})})),this._element.querySelector(".card__delete-button").addEventListener("click",(()=>this._handleDeleteCard()))}_handleLikeIcon(){this._isLiked?this._removeLike():this._addLike()}_addLike(){this._api.addLike(this._id).then((e=>{this._isLiked=e.isLiked,this._updateLikeButton()}))}_removeLike(){this._api.removeLike(this._id).then((e=>{this._isLiked=e.isLiked,this._updateLikeButton()}))}_updateLikeButton(){this._isLiked?this._cardLikeButton.classList.add("card__like-button_active"):this._cardLikeButton.classList.remove("card__like-button_active")}_handleDeleteCard(){this._element.remove(),this._element=null}getView(){return this._element=this._getTemplate(),this._element.querySelector(".card__image").src=this._link,this._element.querySelector(".card__image").alt=this._name,this._element.querySelector(".card__title").textContent=this._name,this._cardLikeButton=this._element.querySelector(".card__like-button"),this._updateLikeButton(),this._setEventListeners(),this._element}}class n{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s)}renderItems(){this._items.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}class r{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("modal_opened")||e.target.classList.contains("modal__close"))&&this.close()}))}}class i extends r{constructor(e){super(e),this._image=this._popup.querySelector(".modal__image"),this._caption=this._popup.querySelector(".modal__caption")}open({name:e,link:t}){this._image.src=t,this._image.alt=e,this._caption.textContent=e,super.open()}}class o extends r{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".modal__form")}_getInputValues(){const e=this._form.querySelectorAll(".modal__input"),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this._form.reset()}))}}class a extends r{constructor(e,t){super(e),this._handleConfirm=t,this._popup?(this._confirmButton=this._popup.querySelector(".modal__submit"),this._closeButton=this._popup.querySelector(".modal__close"),this._setEventListeners()):console.error("Popup element not found:",e)}_setEventListeners(){this._confirmButton&&this._confirmButton.addEventListener("click",(()=>{const e=this._cardId;this._handleConfirm(e),this.close()})),this._closeButton&&this._closeButton.addEventListener("click",(()=>{this.close()}))}open(e){this._cardId=e,super.open()}}class l{constructor({nameSelector:e,jobSelector:t}){this._nameElement=document.querySelector(e),this._jobElement=document.querySelector(t)}getUserInfo(){return{name:this._nameElement.textContent,job:this._jobElement.textContent}}setUserInfo({name:e,job:t}){this._nameElement.textContent=e,this._jobElement.textContent=t}}const c=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}updateProfile(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}updateProfileAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}createCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}removeLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"55f75f9b-43cd-4f65-a141-e29dd49200ac","Content-Type":"application/json"}});document.addEventListener("DOMContentLoaded",(()=>{const r=document.querySelector(".profile__edit-button"),d=document.querySelector("#profile-add-button"),h=document.querySelector(".modal__input-title"),_=document.querySelector(".modal__input-description"),u=document.querySelector("#profile-form"),m=document.querySelector("#add-form"),p=new l({nameSelector:".profile__title",jobSelector:".profile__description"}),v=new n({items:[],renderer:e=>{const t=y(e,c);v.addItem(t)}},".cards__list-content"),f=new i("#modal-image-preview");f.setEventListeners();const L=new o("#profile-edit-modal",(e=>{const t={name:e.name,about:e.job},s=document.querySelector("#modal-button");s.textContent="Saving...",c.updateProfile(t).then((e=>{p.setUserInfo({name:e.name,job:e.about});const t=document.querySelector(".profile__image");t.src=e.avatar,t.alt=e.name,L.close()})).catch((e=>{console.error("Error updating profile information:",e)})).finally((()=>{s.textContent="Save"}))}));L.setEventListeners();const E=new o("#profile-add-modal",(e=>{const t={name:e["add-title"],link:e["link-type"]},s=document.querySelector("#modal-submit-button");s.textContent="Saving...",console.log("Sending card data:",t),c.createCard(t).then((e=>{console.log("Card added successfully:",e);const t=y(e,c);v.addItem(t),E.close(),m.reset(),k.disableButton()})).catch((e=>{console.error("Error adding new card:",e)})).finally((()=>{s.textContent="Create"}))}));E.setEventListeners();const b=new a("#delete-confirmation-modal",(e=>{c.deleteCard(e).then((()=>{const t=document.querySelector(`[data-id='${e}']`);t&&t.remove(),console.log("Card deleted successfully.")})).catch((e=>{console.error("Error deleting card:",e)}))})),S=new e(t,u),k=new e(t,m);function y(e,t){const n=new s(e,"#card-template",g,t).getView();return n.querySelector(".card__delete-button").addEventListener("click",(()=>{b.open(e._id)})),n}function g(e){f.open(e)}S.enableValidation(),k.enableValidation(),r.addEventListener("click",(()=>{const e=p.getUserInfo();h.value=e.name,_.value=e.job,L.open(),S.resetValidation()})),d.addEventListener("click",(()=>{k.disableButton(),E.open()})),c.getUserInfo().then((e=>{p.setUserInfo({name:e.name,job:e.about});const t=document.querySelector(".profile__image");t.src=e.avatar,t.alt=e.name})).catch((e=>{console.error("Error fetching user information:",e)})),c.getInitialCards().then((e=>{e.forEach((e=>{const t=y(e,c);v.addItem(t)}))})).catch((e=>{console.error("Error fetching cards:",e)}));const C=document.querySelector("#edit-avatar-button"),q=document.querySelector("#profile-avatar-modal"),I=document.querySelector("#modal-close-button-avatar"),B=document.querySelector("#avatar-link"),w=document.querySelector("#profile-avatar-form");C.addEventListener("click",(()=>{q.classList.add("modal_opened")})),I.addEventListener("click",(()=>{q.classList.remove("modal_opened")})),w.addEventListener("submit",(e=>{e.preventDefault();const t=B.value,s=document.querySelector("#modal-avatar-button");s.textContent="Saving...",c.updateProfileAvatar({avatar:t}).then((e=>{const t=document.querySelector(".profile__image");t.src=e.avatar,t.alt="Profile Avatar",q.classList.remove("modal_opened")})).catch((e=>{console.error("Error updating avatar:",e)})).finally((()=>{s.textContent="Save"}))}))}))}();